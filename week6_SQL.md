```
**ëª©í‘œ**
ë°ì´í„° ê²°ê³¼ ê²€ì¦ê³¼ ì¿¼ë¦¬ íš¨ìœ¨í™”
```

# 6. ë°ì´í„° ê²°ê³¼ ê²€ì¦

- ê°€ë…ì„±ì„ ì±™ê¸°ê¸° ìœ„í•œ SQL ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
- ë°ì´í„° ê²°ê³¼ ê²€ì¦
- ë°ì´í„° ê²°ê³¼ ê²€ì¦ ì˜ˆì‹œ
    
    ![image](https://github.com/user-attachments/assets/942b523e-9caa-436d-a371-d62054fd4953)

    

## 6.2 ê°€ë…ì„±ì„ ì±™ê¸°ê¸° ìœ„í•œ SQL ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

### ğŸ“¢ ë°ì´í„° ê²°ê³¼ ê²€ì¦ì„ í•˜ê¸° ì „ì—

**âœ…ì‹¤ìˆ˜ëŠ” ì–¸ì œ ë°œìƒí•˜ëŠ”ê°€â€”â€”â€”â€”-**

- ë¬¸ë²•ì„ ì˜ëª» ì•Œê³  ìˆëŠ” ê²½ìš° : ë¬¸ë²• ê³µë¶€
- ë°ì´í„°ë¥¼ íŒŒì•…í•˜ì§€ ì•Šê³  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ê²½ìš°: ë°ì´í„°, ì»¬ëŸ¼ ì •ë³´, valueì— ëŒ€í•œ ì„¤ëª…
- ì¿¼ë¦¬ê°€ ë³µì¡í•œ ê²½ìš°: ë‹¨ìˆœí•˜ê²Œ ë³´ì´ë„ë¡ ìª¼ê°œì•¼ í•¨

**âœ…ë‹¤ë¥¸ ì‚¬ëŒì˜ ì¿¼ë¦¬ë¥¼ ë´ì•¼í•˜ëŠ” ê²½ìš° ë˜ëŠ” ë‚´ ì¿¼ë¦¬ë¥¼ ë‹¤ë¥¸ ì‚¬ëŒì´ ë³´ëŠ” ê²½ìš°**

- ì¿¼ë¦¬ë¥¼ ê°€ë…ì„±ìˆê²Œ ì˜ ì‘ì„± â†’ í•œë²ˆì— ì´í•´í•˜ë„ë¡ í•¨
- ë§¤ë²ˆ ì„¤ëª…í• ìˆ˜ë¡ ë¹„íš¨ìœ¨ì 
- ì¿¼ë¦¬ë¥¼ ë³€ê²½í•  ë•Œ íŠ¹ì • ë¶€ë¶„ë§Œ ë°”ê¿¨ëŠ”ì§€, ì „ì²´ë¥¼ ë°”ê¿¨ëŠ”ì§€ë„ íŒŒì•…í•˜ëŠ” ê²ƒì´ ì‰¬ìš°ë©´ ì¢‹ìŒ

### ğŸ§¨ê°€ë…ì„±ì„ ì±™ê¸°ê¸° ìœ„í•œ SQL ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

- SQL ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
- mozilla(fire fox)ì˜ SQL ê°€ì´ë“œ

1. ì˜ˆì•½ì–´ëŠ” ëŒ€ë¬¸ìë¡œ ì‘ì„±
    - SQLì—ì„œ ë¬¸ë²•ì ì¸ ìš©ë„ë¡œ ì‚¬ìš©í•˜ê³  ìˆëŠ” ë¬¸ìë“¤ì€ ëŒ€ë¬¸ìë¡œ ì‘ì„±
    - ì˜ˆì•½ì–´ì˜ ëŒ€í‘œì ì¸ ì˜ˆì‹œ: SELECT, FROM, WEHRE ê°ì¢… í•¨ìˆ˜

```sql
SELECT
	col
FROM table
WHERE
```

1. ì»¬ëŸ¼ ì´ë¦„ì€ snake_caseë¡œ ì‘ì„±
    - ì»¬ëŸ¼ì˜ ì´ë¦„ì€ snake_caseë¡œ ì‘ì„±
    - **ì¼ê´€ì„±ì´ ì¤‘ìš”!**

```sql
SELECT
	col1 AS event_status,
FROM table
```

1. ëª…ì‹œì  vs ì•”ì‹œì 
    - Aliasë¡œ ë³„ì¹­ì„ ì§€ì„ ë•ŒëŠ” ëª…ì‹œì ì¸ ì´ë¦„ì„ ì ìš©
    - AS a, AS b ë“± ì»¬ëŸ¼ì˜ ì˜ë¯¸ë¥¼ í•œë²ˆ ë” ìƒê°í•˜ê²Œ í•˜ëŠ” ì´ë¦„ì´ ì•„ë‹Œ ëª…ì‹œì ì¸ ê²ƒì„ ì‚¬ìš©
    - JOINí•  ë•Œ í…Œì´ë¸”ì˜ ì´ë¦„ë„ ëª…ì‹œì ìœ¼ë¡œ í•  ìˆ˜ ìˆë‹¤ë©´ ëª…ì‹œì ìœ¼ë¡œ ì§„í–‰
    - ASë¥¼ ìƒëµí•´ì„œ ë³„ì¹­ì„ ì„¤ì •í•  ìˆ˜ë„ ìˆëŠ”ë°, ASë¥¼ ì“°ëŠ” ê²ƒë„ ëª…ì‹œì ì¸ í‘œí˜„
2. ì™¼ìª½ ì •ë ¬
    - ê¸°ë³¸ì ìœ¼ë¡œ ì™¼ìª½ ì •ë ¬ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±

```sql
SELECT
	col
FROM table
WHERE 1=1
```

1. ì˜ˆì•½ì–´ë‚˜ ì»¬ëŸ¼ì€ í•œ ì¤„ì— í•˜ë‚˜ì”© ê¶Œì¥
    - ì»¬ëŸ¼ì€ ë°”ë¡œ ì£¼ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆê¸°ì— í•œ ì¤„ì— í•˜ë‚˜ì”© ì‘ì„±
2. ì‰¼í‘œëŠ” ì»¬ëŸ¼ ë°”ë¡œ ë’¤ì—
    - ì‰¼í‘œ ì• vs ë’¤
    - big queryëŠ” ë§ˆì§€ë§‰ ì‰¼í‘œë¥¼ ë¬´ì‹œí•´ì„œ ë’¤ë¡œ ì‘ì„±í•´ë„ ë¬´ë°©

```sql
SELECT
	col1,
	col2,
FROM table	
```

## 6.3 ê°€ë…ì„±ì„ ì±™ê¸°ê¸° ìœ„í•œ WITHë¬¸ & íŒŒí‹°ì…˜

SQL ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ë‹¤ ìƒê¸°ëŠ” ì¼

- ë§Œì•½ ì•„ë˜ ì¿¼ë¦¬ê°€ ë‹¤ë¥¸ ê³³ì—ì„œë„ í•„ìš”í•˜ë©´ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°

```sql
SELECT
	col,col2
FROM(
	SELECT
		col,col2,col3...
	FROM
		table
```

ğŸ”½

```sql
WITH temp_table AS(
	SELECT
		col,col2,col3...
	FROM
		Table
)
SELECT
	col,col2
FROM temp_table
```

### with êµ¬ë¬¸

- CTE(common table expression)
- SELECTêµ¬ë¬¸ì— ì´ë¦„ì„ ì •í•´ì£¼ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤
- ì¿¼ë¦¬ ë‚´ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆìŒ

```sql
WITH name_a AS(
	SELECT
		col
	FROM Table
), name_b AS(
	SELECT
		col2
	FROM Table2
)
SELECT
	col
FROM name_b
```

- table ë”°ë¡œ ì €ì¥ ê°€ëŠ¥
- view â† ì¿¼ë¦¬ ë©ì–´ë¦¬ but ëŠë¦¼
- ìƒí™©ì— ë”°ë¼ ê²°ì •ë¨

### PARTITION

- tableì—” partitionì´ë€ ê²ƒì´ ì¡´ì¬í•  ìˆ˜ ìˆìŒ
- íŠ¹ì • ì‹œê¸°ì— ë“¤ì–´ì˜¨ ë¬¼ê±´ì„ ì°¾ê³  ì‹¶ë‹¤ë©´?
    - ì• ì´ˆì— ì¼ìë³„ë¡œ ì •ë¦¬í•˜ë©´ ë¨

### PARTITIONì„ ì‚¬ìš©í•˜ë©´ ì¢‹ì€ ì 

1. ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒ
    - ì „ì²´ ë°ì´í„°ë¥¼ ìŠ¤ìº”í•˜ëŠ” ê²ƒë³´ë‹¤ íŒŒí‹°ì…˜ì„ ì„¤ì •í•œ ê³³ë§Œ ìŠ¤ìº”í•˜ëŠ” ê²ƒì´ ë” ë¹ ë¦„
2. ë°ì´í„° ê´€ë¦¬ ìš©ì´ì„±
    - íŠ¹ì • ì¼ìì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ ë³€ê²½í•˜ê±°ë‚˜ ì‚­ì œí•´ì•¼ í•˜ë©´ íŒŒí‹°ì…˜ì„ ì„¤ì •í•´ì„œ ì‚­ì œí•  ìˆ˜ ìˆìŒ
3. ë¹„ìš©
    - íŒŒí‹°ì…˜ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë§Œ ìŠ¤ìº”í•´ì„œ ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆìŒ
    - big queryëŠ” ì¿¼ë¦¬ ìš©ëŸ‰ì— ë¹„ë¡€í•´ì„œ ê³¼ê¸ˆ

### PARTITION table: battle

- battle í…Œì´ë¸”ì´ íŒŒí‹°ì…˜ìœ¼ë¡œ ì„¤ì •ëœ í…Œì´ë¸”
- ìƒˆ íƒ­ì—ì„œ ì—´ë©´ íŒŒí‹°ì…˜ì´ ìë™ìœ¼ë¡œ ì ìš©
- ë¹„ìš© íš¨ìœ¨ì ìœ¼ë¡œ ì¿¼ë¦¬ ì‹¤í–‰ ê°€ëŠ¥

### PARTITION tableì—ì„œ ì¿¼ë¦¬í•˜ê¸°

- where ì ˆì— íŒŒí‹°ì…˜ ì»¬ëŸ¼ì— ëŒ€í•´ ì¡°ê±´ì„ ì„¤ì •í•´ì„œ ì‚¬ìš©
- 2023-12-19ë¶€í„° í•  ì „ë‚ ì˜ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ì¿¼ë¦¬(ì €ì¥ëœ ë°ì´í„°ëŠ” ë” ê³¼ê±°ì˜ ë°ì´í„°ë¼ ì´ ì¿¼ë¦¬ë¥¼ ëŒë¦´ ë•Œ ê²°ê³¼ëŠ” ë‚˜ì˜¤ì§€ ì•ŠìŒ)
- ìŠ¤í‚¤ë§ˆ> ì„¸ë¶€ì •ë³´>í…Œì´ë¸” ìœ í˜•: íŒŒí‹°ì…˜
- ìƒˆ íƒ­ì—ì„œ ì—´ê¸°

```sql
SELECT
	*
FROM 'inflearn-bigquery.basic.battle'
WHERE battle_datetime BETWEEN DATETIME("2022-01-26") 
AND DATETIME_ADD("2024-01-26", INTERVAL 1 DAY)
```

- ì—¬ê¸° ë‚˜ì˜¤ëŠ” ìš©ëŸ‰= íƒìƒ‰í•˜ëŠ” ë²”ìœ„

```sql
WITH sample AS(
	SELECT
		*
	FROM 'inflearn-bigquery.basic.battle'
), sample2 AS (
	SELECT
		id, name, hometown
	FROM basic.trainer
	WHERE
		id=3
), sample3 AS (
	SELECT
		*
	FROM sample2
)	
SELECT
	*
FROM sample
```

## 6.4 ë°ì´í„° ê²°ê³¼ ê²€ì¦ ì •ì˜

ê°‘ì‘ìŠ¤ëŸ½ê²Œ ë°ì´í„° ì¶”ì¶œì„ í•´ì•¼í•˜ëŠ” ìƒí™©ì— ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ì¶”ì¶œ í›„ ê³µìœ 

â‡’ ê²°ê³¼ ê²€ì¦ì— ëŒ€í•œ ë‚´ìš©

### ê²°ê³¼ ê²€ì¦ì„ ì˜í•˜ê¸° ìœ„í•œ ë§ˆì¸ë“œì…‹

ë°ì´í„° ê²€ì¦ì„ í•˜ì§€ ëª»í•´ì„œ ì‹¤ìˆ˜í•˜ëŠ” ê²ƒì€ ë‹¹ì—°~

**ë‹¤ë§Œ ê·¸ ì‹¤ìˆ˜ê°€ ë°˜ë³µë˜ëŠ” ê²ƒì€ ë¬¸ì œ!**

### ë°ì´í„° ê²°ê³¼ ê²€ì¦ì˜ ì •ì˜

- SQL ì¿¼ë¦¬ ì–»ì€ ê²°ê³¼ê°€ ì˜ˆìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •
- ëª©ì : ë¶„ì„ ê²°ê³¼ì˜ ì •í™•ì„±, ì‹ ë¢°ì„± í™•ë³´
- ë°©ë²•
    - ê¸°ëŒ€í•˜ëŠ” ì˜ˆìƒ ê²°ê³¼ ì •ì˜
    - ì¿¼ë¦¬ ì‘ì„±
    - ë‘ê°œê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ë¹„êµ
- ì œì¼ ì¤‘ìš”í•œ ë¶€ë¶„
    - ë¬¸ì œë¥¼ ì˜ ì •ì˜í•˜ê³  ë¯¸ë¦¬ ì‘ì„±
    - ë„ë©”ì¸ íŠ¹ìˆ˜ì„± ì˜ íŒŒì•…í•˜ê¸°
    - SQL ì¿¼ë¦¬ í…œí”Œë¦¿ê³¼ ë§¥ë½ì´ ìœ ì‚¬

1. ë¬¸ì œ ì •ì˜
    - êµ¬ì²´ì ì¸ ë¬¸ì œ ì •ì˜
    - ìš”ì²­ì‚¬í•­ë„ êµ¬ì²´ì ìœ¼ë¡œ í™•ì¸
2. input/output
    - ë°ì´í„°ì˜ inputê³¼ ì›í•˜ëŠ” í˜•íƒœì˜ output ì‘ì„±í•˜ê¸°
    - input-â€ì¤‘ê°„ ê²°ê³¼â€-outputì—ì„œ ì¤‘ê°„ ê²°ê³¼ ìƒê°í•˜ê¸°
3. ì¿¼ë¦¬ ì‘ì„±
    - ê°€ë…ì„± ì±™ê¸°ê¸°
4. ê²°ê³¼ ë¹„êµ
    - ì˜ˆìƒê³¼ ì‹¤ì œ ì¿¼ë¦¬ ê²°ê³¼ì˜ ì°¨ì´ê°€ ìˆëŠ”ì§€ í™•ì¸
    - ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ ë‹¤ì‹œ ëŒì•„ê°

### ë°ì´í„° ê²°ê³¼ ê²€ì¦í•  ë•Œ ìì£¼ í™œìš©í•˜ëŠ” SQLì¿¼ë¦¬

1. count(*): í–‰ìˆ˜ë¥¼ í™•ì¸, ì˜ë„í•œ ë°ì´í„°ì˜ í–‰ ê°œìˆ˜ê°€ ë§ëŠ”ê°€
2. not null: íŠ¹ì • ì»¬ëŸ¼ì— nullì´ ì¡´ì¬í•˜ëŠ”ê°€? í•„ìˆ˜ í•„ë“œê°€ ë¹„ì–´ìˆì§€ ì•Šì€ê°€(=ë°ì´í„°ê°€ ì˜ ì €ì¥ë˜ì–´ìˆëŠ”ê°€)
3. distinct: ë°ì´í„°ì˜ ê³ ìœ ê°’ì„ í™•ì¸í•´ **ì¤‘ë³µ ì—¬ë¶€ í™•ì¸, count(distinct)=count()**
4. ifë¬¸, case when: ì˜ë„ì™€ ê°™ë‹¤ë©´ true, ì•„ë‹ˆë©´ false

1)+3)

â‡’ SELECT COUNT(DISTINCT col), COUNT(col) ë‘ ì»¬ëŸ¼ì„ ë³´ê³  ê°œìˆ˜ë¥¼ ë¹„êµ

### ë°ì´í„° ê²°ê³¼ ê²€ì¦ì„ í•  ë•Œ í™œìš©í•˜ëŠ” ë°©ì‹

1. íŠ¹ì • user_idë¡œ í•„í„°ë§ì„ ê±¸ì–´ì„œ í™•ì¸
    1. 1ëª…ì˜ ë°ì´í„° í™•ì¸
    2. ê²°ê³¼ë¥¼ ì˜ˆìƒí•  ë–„ rawë°ì´í„°ì—ì„œ í•˜ë‚˜ì”© ì„¸ê³  ì ìŒ
    3. 1ëª…ì´ ë°ì´í„°ì˜ ì˜ˆìƒ ê²°ê³¼ê³¼ ì¿¼ë¦¬ ê²°ê³¼ê°€ ë™ì¼í•œì§€ í™•ì¸
    4. ë‹¤ë¥¸ user_id 3-4ê±´ ì¶”ê°€í•´ì„œ í™•ì¸
    5. 3-4ê°œì—ì„œ ë™ì¼í•œ ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´ user_id ì¡°ê±´ì„ ì‚­ì œ
2. ìƒ˜í”Œ ë°ì´í„° ìƒì„±
    1. withë¬¸ì„ ì‚¬ìš©í•´ ì˜ˆì‹œ ë°ì´í„°ë¥¼ ìƒì„±í•œ í›„, ê²°ê³¼ë¥¼ ì˜ˆìƒí•˜ê³  ì¿¼ë¦¬ ì‘ì„±
    2. ë³µì¡í•œ ë°ì´í„°ì—ì„œ í•˜ê¸° ì „ì—, ì¿¼ë¦¬ ìì²´ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©
    3. union all: ì„¸ë¡œë¡œ ì•„ë˜ë¡œ ë¶™ì¸ë‹¤

## 6.5 ë°ì´í„° ê²°ê³¼ ê²€ì¦ ì˜ˆì‹œ

### íŠ¸ë ˆì´ë„ˆ ë°°í‹€ ì„±ì  ë¶„ì„, ê° íŠ¸ë ˆì´ë„ˆê°€ ì§„í–‰í•œ ë°°í‹€ì˜ ìŠ¹ë¦¬ ë¹„ìœ¨ ê³„ì‚°â†’ 9íšŒ ì´ìƒì¸ ê²½ìš°ë§Œ ê³„ì‚°

- ìŠ¹ë¦¬ ë¹„ìœ¨(=ìŠ¹ë¦¬í•œ íšŸìˆ˜/ ì´ ë°°í‹€ íšŸìˆ˜)

â‡’ ê°„ë‹¨í•œ ë¬¸ì œë¼ì„œ ì´ë ‡ê²Œ í•´ë„ í‹€ë¦´ ê°€ëŠ¥ì„±ì´ ì ìŒ

- ë°ì´í„° ê²°ê³¼ ê²€ì¦ì„ í•œë‹¤ë©´ ì–´ë–»ê²Œ í•  ê²ƒì¸ì§€?

```
**ì´ìƒì ì¸...ë°ì´í„° ê²°ê³¼ ê²€ì¦ í”„ë¡œì„¸ìŠ¤**

1) ì „ì²´ ë°ì´í„° íŒŒì•…
2) íŠ¹ì • user_id ì„ ì •
3) ìŠ¹ë¥  ì§ì ‘ COUNT: ê²°ê³¼ ì˜ˆìƒ
4) ì¿¼ë¦¬ ì‘ì„±
5) ì‹¤ì œì™€ ë¹„êµ
6) ë§ë‹¤ë©´ íŠ¹ì • ìœ ì € ì¡°ê±´ ì œì™¸

```

1. íŠ¹ì • user_id ì„ ì •
    - íŠ¹ì • user_id(battleì—ì„  playerN_id)ë¥¼ ì„ ì •
    - íšŒì‚¬ì—ì„  ìì‹ ì˜ user_idë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ ì—¬ê¸°ì„  ì„ì˜ë¡œ ì„ íƒ
    
    ```sql
    SELECT
    	*
    FROM 'basic.battle'
    WHERE
    	(player1_id=7) or (player2_id=7)
    ```
    
2. ìŠ¹ë¥  ì§ì ‘ count: ê²°ê³¼ ì˜ˆìƒ
    - player_id(player1_id, player2_id)ê°€ 7ì¸ ìœ ì €ì˜ ìŠ¹ë¥ 
    - ì´ 9íšŒ ì¤‘ 5ë²ˆ =5/9=0.5555
3. ì¿¼ë¦¬ ì‘ì„±
    - íŠ¸ë ˆì´ë„ˆê°€ ìŠ¹ë¦¬í•œ ë¹„ìœ¨ êµ¬í•˜ê¸°
        - íŠ¸ë ˆì´ë„ˆê°€ ì°¸ì—¬í•œ ë°°í‹€ì˜ ìˆ˜ êµ¬í•˜ê¸°
        - íŠ¸ë ˆì´ë„ˆê°€ ìŠ¹ë¦¬í•œ ë°°í‹€ì˜ ìˆ˜ êµ¬í•˜ê¸°
        - ë‘ê°œ ì¡°í•©í•´ì„œ ìŠ¹ë¦¬í•œ ë¹„ìœ¨ êµ¬í•  ìˆ˜ ìˆìŒ
        - ë°°í‹€ì˜ ìˆ˜ê°€ 9 ì´ìƒë§Œ ì¶”ì¶œ
    - í†µí•© ë°ì´í„° ìƒì„±(player1,2 êµ¬ë¶„ì„ í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” í…Œì´ë¸” â†’ trainer_id ìƒì„±)

```sql
SELECT
	*
FROM(
	SELECT
	id AS battle_id,
	player1_id AS trainer_id,
	winner_id
FROM 'basic.battle'
UNION ALL
SELECT
	id AS battle_id,
	player2_id AS tariner_id,
	winner_id
FROM 'basic.battle'
)
ORDER BY battle_id
```

- trainer_id=7ì˜ ì´ ë°°í‹€ íšŸìˆ˜ë¥¼ êµ¬í•˜ëŠ” ì¿¼ë¦¬

```sql
WITH battle_basic AS(
	SELECT
		id AS battle_id,
		player1_id AS trainer_id.
		winner_id
	FROM 'basic.battle'
	UNION ALL
	SELECT
		id AS battle_id,
		player2_id AS trainer_id,
		winner_id
	FROM 'basic.battle'
)
SELECT
	trainer_id,
	COUNT(*) AS total_battles,
	COUNT(DISTINCT battle_id) AS unique_battles
FORM battle_basic
WHERE trainer_id=7
GROUP BY
	trainer_id
```

1. ì‹¤ì œì™€ ë¹„êµ
- COUNTIFë¥¼ ì‚¬ìš©í•´ ê°’ êµ¬í•˜ê¸°

```sql
WITH battle_basic AS(
	SELECT
		id AS battle_id,
		player1_id AS trainer_id.
		winner_id
	FROM 'basic.battle'
	UNION ALL
	SELECT
		id AS battle_id,
		player2_id AS trainer_id,
		winner_id
	FROM 'basic.battle'
)
SELECT
	*,
	CASE,
		WHEN trainer_id=winner_id THEN "WIN"
		WHEN winner_id IS NULL THEN "DARW"
		ELSE "LOSE"
	END AS battle result
FROM battle_basic
--WHERE trainer_id=7
)
SELECT
	trainer_id,
	COUNT(battle_result='WIN') AS win_count
	COUNT(battle_id) AS total_battle_count
	COUNT(battle_result='WIN')/COUNT(DISTINCT battle_id) AS win_ratio
FROM battle_with_result
GROUP BY
	trainer_id
HAVING
	total_battle_count>=9
```

### ì˜ˆì‹œì—ì„œ ì˜ˆìƒí•œ ê²°ê³¼

- trainer_ id=7ì¼ë•Œ ë°°í‹€ì˜ íšŸìˆ˜: 9
- ìŠ¹ë¦¬í•œ íšŸìˆ˜: 5
- ìŠ¹ë¦¬í•œ ë¹„ìœ¨: 0.555

## 6-6. ì •ë¦¬

![image](https://github.com/user-attachments/assets/c4420c93-f7f0-4606-b160-06a0ac2fcce9)

![image](https://github.com/user-attachments/assets/9dde61f8-775f-4a1d-a1ec-4e885cb8514d)
